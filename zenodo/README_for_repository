Dataset title: Data and Code for Lowman et al. "Macroscale controls determine the recovery of river ecosystem productivity following flood disturbances" 

Creators: Heili E. Lowman (University of Nevada Reno), Robert Shriver (University of Nevada Reno), Robert O. Hall Jr. (Flathead Lake Biological Station), Judson Harvey (USGS), Phil Savoy (USGS), Charles Yackulic (USGS), Joanna R. Blaszczak (University of Nevada Reno)

Contact: Heili Lowman (heili.lowman@gmail.com)

Keywords: Ecosystem recovery, disturbance, river, algae, ecosystem metabolism

Funding: This research was supported by the Modelscape Consortium, funded by the National Science Foundation’s Established Program to Stimulate Competitive Research (EPSCoR) award #OIA-2019528.

Timeframe of Data: January 2007 - December 2017

Geographic Location of Data: United States of America

###

Data Provenance: Data for this project were downloaded from multiple published data sources including:

Appling, A.P., Read, J.S., Winslow, L.A., Arroita, M., Bernhardt, E.S., Griffiths, N.A., Hall, R.O., Jr., Harvey, J.W., Heffernan, J.B., Stanley, E.H., Stets, E.G., and Yackulic, C.B., 2018, Metabolism estimates for 356 U.S. rivers (2007-2017): U.S. Geological Survey data release, https://doi.org/10.5066/F70864KX.

Blaszczak, J.R., Koenig, L.E., Mejia, F.H., Gómez-Gener, L., Dutton, C.L., Carter, A.M., Grimm, N.B., Harvey, J.W., Helton, A.M., Cohen, M.J., Anyanwu, E.D., Pokrovsky, O.S., Krickov, I.V., Manasypov, R.M., Vorobyev, S.N., and Serikova, S., 2021, Distribution, frequency, and global extent of hypoxia in rivers: U.S. Geological Survey data release, https://doi.org/10.5066/P99X6SIR.

Bernhardt, E.S., Savoy, P., Vlah, M.J., Appling, A.P., Koenig, L.E., Hall Jr., R.O., Arroita, M., Blaszczak, J.R., Carter, A.C., Cohen, M., Harvey, J.W., Heffernan, J.B., Helton, A.M., Hosen, J.D., Kirk, L., McDowell, W.H., Stanley, E.H., Yackulic, C., and Grimm, N.B., 2022 Light and flow regimes regulate the metabolism of rivers. Proc. Natl. Acad. Sci. U.S.A. 119, e2121976119. (Data available at https://github.com/streampulse/metabolism_synthesis)

Note: Daily discharge data for each river from 1970-01-01 to 2020-12-31 and dissolved nutrient data for available rivers from 2007-01-01 to 2017-12-31 measured by the USGS were downloaded using the 'dataRetrieval' package in R.

###

Code: All of the following scripts were written and run using R in RStudio.

#
File name: 01_NWIS_RiverSelection.R
File description: Code to filter and select rivers based on the completeness and quality of their GPP time series from Appling et al. (2018). All URLs to download published, raw data files required by this script are provided in comments.
Category: Data Preparation
Scripting Language: R
Data Files Required: site_data.tsv, GRDO_GEE_HA_NHD.csv, diagnostics.tsv, daily_predictions.tsv
Data Files Generated: NWIS_198sites_050423.rds, NWIS_198sitesinfo_050423.rds, NWIS_198sitesNdays_050423.rds

#
File name: 02_StreamLight_processing.R
File description: Code to use GPP time series to filter existing surface light data estimates from Bernhardt et al. (2022). All URLs to download published, raw data files required by this script are provided in comments.
Category: Data Preparation
Scripting Language: R
Data Files Required: NWIS_198sites_050423.rds, NWIS_198sitesinfo_050423.rds, NWIS_198sitesNdays_050423.rds, lotic_standardized_full.rds
Data Files Generated: StreamLight_daily_df_182sites_050423.rds, StreamLight_daily_list_182sites_050423.rds

#
File name: 03_DataSource_181rivers_StreamLight.R
File description: Code to compile and format time series for rivers with StreamLight PAR. This generates four separate data files that were used to fit models in parallel.
Category: Data Preparation
Scripting Language: R
Data Files Required: NWIS_198sites_050423.rds, NWIS_198sitesinfo_050423.rds, StreamLight_daily_df_182sites_050423.rds
Data Files Generated: list_181sites_Qmaxnorm_SavoySL.rds, df_181sites_Qmaxnorm_SavoySL.rds, list_181sites_Qmaxnorm_SavoySL_pt1.rds, list_181sites_Qmaxnorm_SavoySL_pt2.rds, list_181sites_Qmaxnorm_SavoySL_pt3.rds, list_181sites_Qmaxnorm_SavoySL_pt4.rds

#
File name: 04_Biomass_fit_model_pt1.R
File description: Code to compile data and call "Stan_ProductivityModel.stan" to fit latent biomass model. Note, this script was run on the University of Wyoming's Beartooth High Performance Computing Cluster so the final file directory included points to the UW server.
Category: Model Fit
Scripting Language: R
Data Files Required: list_181sites_Qmaxnorm_SavoySL_pt1.rds
Data Files Generated: beartooth_181rivers_output_pt1_2023_05_05.rds

#
File name: 04_Biomass_fit_model_pt2.R
File description: Code to compile data and call "Stan_ProductivityModel.stan" to fit latent biomass model. Note, this script was run on the University of Wyoming's Beartooth High Performance Computing Cluster so the final file directory included points to the UW server.
Category: Model Fit
Scripting Language: R
Data Files Required: list_181sites_Qmaxnorm_SavoySL_pt2.rds
Data Files Generated: beartooth_181rivers_output_pt2_2023_05_05.rds

#
File name: 04_Biomass_fit_model_pt3.R
File description: Code to compile data and call "Stan_ProductivityModel.stan" to fit latent biomass model. Note, this script was run on the University of Wyoming's Beartooth High Performance Computing Cluster so the final file directory included points to the UW server.
Category: Model Fit
Scripting Language: R
Data Files Required: list_181sites_Qmaxnorm_SavoySL_pt3.rds
Data Files Generated: beartooth_181rivers_output_pt3_2023_05_05.rds

#
File name: 04_Biomass_fit_model_pt4.R
File description: Code to compile data and call "Stan_ProductivityModel.stan" to fit latent biomass model. Note, this script was run on the University of Wyoming's Beartooth High Performance Computing Cluster so the final file directory included points to the UW server.
Category: Model Fit
Scripting Language: R
Data Files Required: list_181sites_Qmaxnorm_SavoySL_pt4.rds
Data Files Generated: beartooth_181rivers_output_pt4_2023_05_05.rds

#
File name: Stan_ProductivityModel.stan
File description: Code for the latent biomass time series model.
Category: Model Fit
Scripting Language: STAN
Data Files Required: NA
Data Files Generated: NA

#
File name: 05_BeartoothOutput_processing.R
File description: Code to extract all iterations for daily and site-level parameter estimates.
Category: Model Output Preparation
Scripting Language: R
Data Files Required: beartooth_181rivers_output_pt1_2023_05_05.rds, beartooth_181rivers_output_pt2_2023_05_05.rds, beartooth_181rivers_output_pt3_2023_05_05.rds, beartooth_181rivers_output_pt4_2023_05_05.rds
Data Files Generated: beartooth_181rivers_model_all_params_all_iterations_050823pt1.rds, beartooth_181rivers_model_all_params_all_iterations_050823pt2.rds, beartooth_181rivers_model_all_params_all_iterations_050823pt3.rds, beartooth_181rivers_model_all_params_all_iterations_050823pt4.rds, beartooth_181rivers_model_params_all_iterations_050823.rds, beartooth_181rivers_model_diags_050923.rds, beartooth_181rivers_model_divs_050923.rds

#
File name: 06_Discharge_2yearflood.R
File description: Code to estimate the 2-year flood for each river using USGS daily discharge data.
Category: Data Preparation
Scripting Language: R
Data Files Required: beartooth_181rivers_model_diags_050923.rds
Data Files Generated: NWIS_Info_181riv_050923.rds, RI_2yr_flood_180riv_050923.csv

#
File name: 07_HUC2_delineation.R
File description: Code to delineate HUC2 values for each river.
Category: Data Preparation
Scripting Language: R
Data Files Required: NWIS_Info_181riv_050923.rds
Data Files Generated: NWIS_Info_181riv_HUC2_df_050923.rds

#
File name: 08_Nutrient_data_assembly.R
File description: Code to retrieve any available dissolved nutrient data (NO3, PO4) for the rivers included in this analysis using USGS nutrient data.
Category: Data Preparation
Scripting Language: R
Data Files Required: list_181sites_Qmaxnorm_SavoySL.rds
Data Files Generated: USGS_WQP_Nutrients_2023_05_09.rds, USGS_WQP_nuts_aggsite_050923.rds

#
File name: 09_parameter_filters.R
File description: Code to filter latent biomass model parameter estimates based on quality of model diagnostics and biologically reasonable values.
Category: QAQC
Scripting Language: R
Data Files Required: GRDO_GEE_HA_NHD_2021_02_07.csv, list_181sites_Qmaxnorm_SavoySL.rds, beartooth_181rivers_model_diags_050923.rds, beartooth_181rivers_model_params_all_iterations_050823.rds, RI_2yr_flood_180riv_050923.csv
Data Files Generated: rmax_filtered_143sites_110723.rds, QcQ2_unfiltered_181sites_051023.rds, QcQ2_filtered_130sites_110723.rds

#
File name: 10_Maximum_algal_yield.R
File description: Code to calculate maximum algal yield based on maximum growth rate and lambda parameter estimates.
Category: Data Preparation
Scripting Language: R
Data Files Required: beartooth_181rivers_model_params_all_iterations_050823.rds, rmax_filtered_143sites_110723.rds
Data Files Generated: maxalgalyield_143sites_110723.rds

#
File name: 11_Qc_exceedances.R
File description: Code to calculate number of exceedances (total and annually) of the flow disturbance threshold of each river.
Category: Data Preparation
Scripting Language: R
Data Files Required: list_181sites_Qmaxnorm_SavoySL.rds, QcQ2_unfiltered_181sites_051023.rds, GRDO_GEE_HA_NHD_2021_02_07.csv
Data Files Generated: Qc_exceedances_181sites_051123.rds

#
File name: 12_Model_and_site_data_aggregation.R
File description: Code to create combined dataset of covariates to be included in post-hoc regression analyses for maximum algal yield (amax) and flow disturbance thresholds (Qc).
Category: Data Preparation
Scripting Language: R
Data Files Required: GRDO_GEE_HA_NHD_2021_02_07.csv, site_data.tsv, list_181sites_Qmaxnorm_SavoySL.rds, beartooth_181rivers_model_diags_050923.rds, beartooth_181rivers_model_params_all_iterations_050823.rds, maxalgalyield_143sites_110723.rds, QcQ2_filtered_130sites_110723.rds, USGS_WQP_nuts_aggsite_050923.rds, NWIS_Info_181riv_HUC2_df_050923.rds, Qc_exceedances_181sites_051123.rds
Data Files Generated: covariate_data_181sites_070523.rds, amax_covariates_143sites_110723.rds, Qc_covariates_130sites_110723.rds

#
File name: 13_Posthoc_analyses.R
File description: Code to run regression analyses for maximum algal yield (amax) and flow disturbance thresholds (Qc) and generate accompanying figures. In addition, code to display values included in geomorphological threshold comparison (Table 1 of manuscript).
Category: Statistical Analyses
Scripting Language: R
Data Files Required: amax_covariates_143sites_110723.rds, Qc_covariates_130sites_110723.rds, QcQ2_unfiltered_181sites_051023.rds, NWIS_Info_181riv_HUC2_df_050923.rds
Data Files Generated: accrual_datin_110723.rds, accrual_brms_110723.rds, accrual_nuts_brms_110723.rds, qc_datin_110723.rds, qcq2_brms_110723.rds

#
File name: 14_Appendix_figures.R
File description: Code to generate appendix figures included in manuscript.
Category: Figures
Scripting Language: R
Data Files Required: amax_covariates_143sites_110723.rds, Qc_covariates_130sites_110723.rds, list_181sites_Qmaxnorm_SavoySL.rds, beartooth_181rivers_model_params_all_iterations_050823.rds, covariate_data_181sites_070523.rds, NWIS_Info_181riv_HUC2_df_050923.rds
Data Files Generated: Ricker_sim_16sites_071123.rds

#
File name: 15_Reviewer_responses.R
File descript: Code for addressing reviewer comments including the following -- justification for normalizing to maximum discharge in a given record rather than the ten-year flood, additional figures demonstrating model results, justification for why time-series length did not influence latent biomass model parameters estimates nor posthoc regression results, investigation of latent biomass model fit with less informative priors, and examination of covariance of disturbance threshold (c) vs. sensitivity of disturbance (s) parameter estimates.
Category: Statistical Analyses/Figures
Scripting Language: R
Data Files Required: beartooth_181rivers_model_params_all_iterations_050823.rds, df_181sites_Qmaxnorm_SavoySL.rds, amax_covariates_143sites_110723.rds, Qc_covariates_130sites_110723.rds, QcQ2_unfiltered_181sites_051023.rds, NWIS_Info_181riv_HUC2_df_050923.rds, covariate_data_181sites_070523.rds, RI_2yr_flood_180riv_050923.csv, RI_10yr_flood_206riv.csv, accrual_datin_110723.rds, qc_datin_110723.rds, accrual_brms_110723.rds, qcq2_brms_110723.rds
Data Files Generated: list_6sites_Q10norm_SavoySL.rds, pinyon_6rivers_output_2023_07_12.rds, pinyon_6rivers_model_cs_params_all_iterations_071223.rds, pinyon_6rivers_model_cs_params_diags_071323.rds, Ricker_sim_1site_081623.rds, list_10sites_5ts_Qmaxnorm_SavoySL_102523.rds, pinyon_10rivers_5ts_output_2023_10_25.rds, pinyon_10rivers_5ts_params_all_iterations_102623.rds, pinyon_10rivers_5ts_params_diags_102623.rds, pinyon_24rivers_3yr300d_output_2023_10_31.rds, pinyon_24rivers_3yr300d_params_all_iterations_110123.rds, pinyon_24rivers_3yr300d_params_diags_110323.rds, accrual20_brms_110323.rds, qcq218_brms_110323.rds, list_6sites_Qmaxnorm_SavoySL.rds, pinyon_6rivers_output_2023_07_13.rds, pinyon_6rivers_model_rc_params_diags_071323.rds

#
File name: Stan_ProductivityModel_lessinformedpriors_R1.stan
File descript: Code for the latent biomass time series model with less informed priors to address reviewer comment.
Category: Model Fit
Scripting Language: STAN
Data Files Required: NA
Data Files Generated: NA

End of metadata file.
